# ビジネス言語化トレーナー 完全版要件定義書

**プロジェクト名**: Business Communication Trainer  
**開発期間**: 3週間（21日間）  
**開発者**: 初心者レベル  
**目的**: インターン用ポートフォリオ作成  
**作成日**: 2025年10月5日  
**バージョン**: 3.0（フル機能版）

---

## 📋 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [技術スタック](#2-技術スタック)
3. [機能要件](#3-機能要件)
4. [データ構造](#4-データ構造)
5. [画面設計](#5-画面設計)
6. [API仕様](#6-api仕様)
7. [セキュリティ要件](#7-セキュリティ要件)
8. [非機能要件](#8-非機能要件)

---

## 1. プロジェクト概要

### 1.1 目的
ビジネスパーソンが会議やプレゼンでの発言力を練習できるモバイルアプリケーション。AI（OpenAI API）を活用して動的な質問生成とフィードバックを提供。

### 1.2 コアバリュー
- **動的AI質問生成**: ユーザーの回答に基づいて3-5問の追加質問を自動生成
- **音声入力対応**: 実際の会議を想定した音声での回答
- **建設的フィードバック**: AIコーチによる具体的な改善提案
- **履歴管理**: 過去の練習を振り返り成長を追跡

### 1.3 ターゲットユーザー
- ビジネスパーソン（20-40代）
- 会議での発言に苦手意識がある人
- プレゼンスキルを向上させたい人

---

## 2. 技術スタック

### 2.1 フロントエンド
```javascript
{
  "core": {
    "framework": "React Native",
    "runtime": "Expo SDK 51+",
    "language": "JavaScript (ES6+)"
  },
  "navigation": {
    "library": "@react-navigation/native",
    "navigators": ["Stack", "Tab"]
  },
  "stateManagement": {
    "global": "React Context API",
    "local": "useState, useReducer"
  },
  "ui": {
    "styling": "StyleSheet, Flexbox",
    "icons": "@expo/vector-icons",
    "animations": "react-native-reanimated"
  }
}
```

### 2.2 バックエンド・サービス
```javascript
{
  "authentication": "Firebase Authentication",
  "database": "Firebase Firestore",
  "storage": "Firebase Storage (将来対応)",
  "ai": "OpenAI API (gpt-4 or gpt-3.5-turbo)",
  "speech": "Expo Speech Recognition",
  "localCache": "AsyncStorage"
}
```

### 2.3 開発ツール
- Git/GitHub（バージョン管理）
- Expo CLI（開発・ビルド）
- Expo Go（実機テスト）
- VS Code（エディタ）

---

## 3. 機能要件

### 3.1 ユーザー認証

#### 3.1.1 サインアップ
**機能**: メールアドレスとパスワードで新規登録

**要件**:
- メールアドレスのバリデーション（正規表現）
- パスワード強度チェック（8文字以上、英数字含む）
- 重複メールアドレスのエラーハンドリング
- 登録成功後、自動ログイン

**UI要素**:
- メールアドレス入力フィールド
- パスワード入力フィールド（マスク表示）
- 「登録」ボタン
- 「既にアカウントをお持ちの方」リンク
- ゲストモード案内

#### 3.1.2 ログイン
**機能**: 既存アカウントでログイン

**要件**:
- メールアドレス・パスワード認証
- 認証エラーの適切な表示
- 「パスワードを忘れた」機能（将来対応）
- ログイン状態の永続化

#### 3.1.3 ゲストモード
**機能**: 認証なしでアプリを試用

**制限事項**:
- データ保存不可（履歴機能使用不可）
- セッション終了後、データ消失
- フィードバック画面で「ログインして保存」を促す

---

### 3.2 場面選択機能

#### 3.2.1 提供する4つのシーン

**1. 週次報告会議**
- 固定質問: 「今週の進捗状況と、現在直面している課題を具体的に説明してください」
- アイコン: 📊
- 説明: 上司や同僚に進捗を報告する場面

**2. プロジェクト提案**
- 固定質問: 「提案するプロジェクトの目的と、なぜ今これが必要なのかを説明してください」
- アイコン: 💡
- 説明: 新規プロジェクトを提案する場面

**3. 問題解決の議論**
- 固定質問: 「直面している問題の具体的な状況と、それが引き起こしている影響を説明してください」
- アイコン: 🔧
- 説明: チームで課題を議論する場面

**4. 顧客へのプレゼン**
- 固定質問: 「提案する商品/サービスと、それがお客様のどんな課題を解決するかを説明してください」
- アイコン: 🎯
- 説明: 顧客に提案する場面

#### 3.2.2 UI要件
- 4つのカードを縦スクロール表示
- 各カード: アイコン + 場面名 + 説明 + 「練習開始」ボタン
- カードタップで詳細表示（モーダル）
- タブレット: 2列グリッド表示

---

### 3.3 練習セッション機能

#### 3.3.1 セッションフロー

```
[開始]
  ↓
[固定質問表示]
  ↓
[音声入力 → テキスト化]
  ↓
[AI追加質問生成（3-5問）]  ← ローディング表示
  ↓
[追加質問1 → 回答]
  ↓
[追加質問2 → 回答]
  ↓
[追加質問3 → 回答]
  ↓
[追加質問4-5 → 回答]（必要に応じて）
  ↓
[AIフィードバック生成]  ← ローディング表示
  ↓
[フィードバック表示]
  ↓
[保存 or 再練習 or 終了]
```

#### 3.3.2 音声入力機能

**要件**:
- Expo Speech Recognitionを使用
- マイク権限のリクエスト
- 録音開始ボタン（タップホールド or トグル）
- 録音中の視覚的フィードバック
  - 波形アニメーション
  - 経過時間表示
  - 音量レベルインジケーター
- 音声→テキスト変換
- テキスト編集機能（誤認識の修正）
- フォールバック: キーボード入力も可能

**エラーハンドリング**:
- マイク権限拒否時の案内
- 音声認識失敗時のリトライ
- ネットワークエラー時の対応

#### 3.3.3 AI質問生成

**入力**:
- 場面ID（sceneId）
- 固定質問（fixedQuestion）
- ユーザーの初回回答（userAnswer）

**処理**:
1. OpenAI APIにリクエスト送信
2. 場面別プロンプトを使用
3. JSON形式でレスポンス受信
4. 質問リスト（3-5問）を取得

**レスポンス例**:
```json
{
  "questions": [
    "そのAPIエラーの具体的な原因は特定できていますか？",
    "3日の遅延は、全体のリリーススケジュールにどう影響しますか？",
    "API提供元には問い合わせていますか？対応状況は？"
  ],
  "totalQuestions": 3,
  "reasoning": "報告が具体的だったため3問に絞りました"
}
```

**エラーハンドリング**:
- API呼び出し失敗時: デフォルト質問を使用
- レート制限エラー: ユーザーに通知し再試行
- タイムアウト: 30秒で中断

#### 3.3.4 進捗表示

**要素**:
- 現在の質問番号 / 総質問数（例: 3/6）
- プログレスバー
- 質問文の表示
- 回答テキストの表示
- 「次へ」ボタン（回答入力後に有効化）
- 「セッション終了」ボタン（確認ダイアログ表示）

---

### 3.4 フィードバック機能

#### 3.4.1 AIフィードバック生成

**入力**:
- 場面名（sceneName）
- 全Q&A履歴（質問と回答のペア配列）

**処理**:
1. OpenAI APIにリクエスト送信
2. フィードバック生成プロンプト使用
3. JSON形式でレスポンス受信

**レスポンス構造**:
```json
{
  "summary": "全体的な印象を1-2文で",
  "goodPoints": [
    {
      "aspect": "具体性",
      "quote": "ECサイトの決済機能を実装中",
      "comment": "プロジェクト名を明確に示していて良い"
    }
  ],
  "improvementPoints": [
    {
      "aspect": "論理構造",
      "original": "遅延しています",
      "improved": "予定より3日遅延していますが、全体スケジュールへの影響は最小限です",
      "reason": "影響範囲まで伝えると安心感を与えられます"
    }
  ],
  "encouragement": "励ましの言葉"
}
```

#### 3.4.2 フィードバック表示

**UI構成**:
1. **ヘッダー**: 「お疲れ様でした！」
2. **サマリー**: 全体的な印象
3. **良かった点セクション**:
   - 見出し: ✅ 良かった点
   - 各ポイントをカード表示
   - 引用部分をハイライト
4. **改善点セクション**:
   - 見出し: 💡 改善のヒント
   - Before/After比較表示
   - 改善の効果説明
5. **励ましメッセージ**
6. **アクションボタン**:
   - 「履歴に保存」（認証済みユーザーのみ）
   - 「もう一度練習」
   - 「別の場面を選ぶ」

---

### 3.5 履歴機能

#### 3.5.1 セッション保存

**保存タイミング**:
- フィードバック表示後、「履歴に保存」ボタンをタップ
- 自動保存オプション（設定で有効化可能）

**保存データ**:
```javascript
{
  sessionId: "uuid",
  userId: "firebaseUserId",
  sceneId: "weekly-report",
  sceneName: "週次報告会議",
  timestamp: "2025-10-05T10:30:00Z",
  qaList: [
    {
      questionId: "q1",
      questionText: "固定質問の内容",
      answerText: "ユーザーの回答",
      answerDuration: 45, // 秒
      isFixedQuestion: true
    }
    // ...追加質問
  ],
  totalQuestions: 5,
  feedback: {
    summary: "...",
    goodPoints: [...],
    improvementPoints: [...]
  },
  duration: 480 // セッション全体の秒数
}
```

#### 3.5.2 履歴一覧画面

**表示内容**:
- セッションカード（最新順）
  - 場面名 + アイコン
  - 日時（相対表示: 2時間前、3日前）
  - 質問数
  - タップで詳細表示
- 空状態: 「まだ練習履歴がありません」
- Pull to Refresh
- 無限スクロール（10件ずつロード）

**フィルター機能**:
- 場面別フィルター
- 日付範囲フィルター

#### 3.5.3 履歴詳細画面

**表示内容**:
- セッション情報
  - 日時
  - 場面名
  - 所要時間
- Q&A履歴（折りたたみ可能）
- フィードバック全文
- アクション
  - 削除ボタン
  - 共有ボタン（将来対応）

---

### 3.6 プロフィール画面

**表示情報**:
- ユーザー名（編集可能）
- メールアドレス
- 登録日
- 統計情報
  - 総練習回数
  - 最も練習した場面
  - 総練習時間

**アクション**:
- ログアウトボタン
- アカウント削除（確認ダイアログ）
- 設定（将来対応）

---

## 4. データ構造

### 4.1 Firestore コレクション

#### users コレクション
```javascript
{
  userId: "firebaseAuthUid",
  email: "user@example.com",
  displayName: "山田太郎",
  createdAt: timestamp,
  lastLoginAt: timestamp,
  settings: {
    autoSave: true,
    notifications: false
  }
}
```

#### sessions コレクション
```javascript
{
  sessionId: "uuid",
  userId: "firebaseAuthUid",
  sceneId: "weekly-report",
  sceneName: "週次報告会議",
  timestamp: timestamp,
  qaList: [
    {
      questionId: "q1",
      questionText: "質問内容",
      answerText: "回答内容",
      answerDuration: 45,
      isFixedQuestion: true
    }
  ],
  totalQuestions: 5,
  feedback: {
    summary: "総評",
    goodPoints: [...],
    improvementPoints: [...]
  },
  duration: 480,
  createdAt: timestamp,
  updatedAt: timestamp
}
```

### 4.2 AsyncStorage（ローカル）

**キー構造**:
```javascript
{
  "@user_token": "firebaseIdToken",
  "@last_session": "sessionDataJSON",
  "@guest_sessions": "array of session objects",
  "@app_settings": "settingsJSON"
}
```

---

## 5. 画面設計

### 5.1 画面一覧

1. **認証関連**
   - LoginScreen
   - SignupScreen

2. **メイン機能**
   - HomeScreen（タブ: ホーム）
   - SceneSelectionScreen
   - PracticeScreen
   - FeedbackScreen

3. **履歴機能**
   - HistoryScreen（タブ: 履歴）
   - SessionDetailScreen

4. **その他**
   - ProfileScreen（タブ: プロフィール）

### 5.2 ナビゲーション構造

```
AuthNavigator (Stack)
  - LoginScreen
  - SignupScreen

MainNavigator (Tab)
  - HomeTab (Stack)
    - HomeScreen
    - SceneSelectionScreen
    - PracticeScreen
    - FeedbackScreen
  - HistoryTab (Stack)
    - HistoryScreen
    - SessionDetailScreen
  - ProfileTab
    - ProfileScreen
```

### 5.3 画面遷移図

```
[LoginScreen]
    ↓ ログイン成功
[HomeScreen (Tab1)]
    ↓ 「練習を始める」
[SceneSelectionScreen]
    ↓ 場面選択
[PracticeScreen]
    ↓ 全質問完了
[FeedbackScreen]
    ↓ 「履歴を見る」
[HistoryScreen (Tab2)]
    ↓ セッション選択
[SessionDetailScreen]

[ProfileScreen (Tab3)]
```

---

## 6. API仕様

### 6.1 OpenAI API - 質問生成

**エンドポイント**: `POST https://api.openai.com/v1/chat/completions`

**リクエスト**:
```javascript
{
  model: "gpt-4",
  messages: [
    {
      role: "system",
      content: "場面別のシステムプロンプト（要件定義書参照）"
    },
    {
      role: "user",
      content: `ユーザーの回答: ${userAnswer}`
    }
  ],
  temperature: 0.7,
  max_tokens: 1000,
  response_format: { type: "json_object" }
}
```

**レスポンス処理**:
```javascript
const response = await openai.chat.completions.create(request);
const content = JSON.parse(response.choices[0].message.content);
// content.questions: string[]
// content.totalQuestions: number
// content.reasoning: string
```

### 6.2 OpenAI API - フィードバック生成

**リクエスト**:
```javascript
{
  model: "gpt-4",
  messages: [
    {
      role: "system",
      content: "フィードバック生成プロンプト"
    },
    {
      role: "user",
      content: `場面: ${sceneName}\n\nQ&A履歴:\n${qaHistory}`
    }
  ],
  temperature: 0.7,
  max_tokens: 2000,
  response_format: { type: "json_object" }
}
```

### 6.3 Firebase Authentication API

**サインアップ**:
```javascript
import { createUserWithEmailAndPassword } from 'firebase/auth';

await createUserWithEmailAndPassword(auth, email, password);
```

**ログイン**:
```javascript
import { signInWithEmailAndPassword } from 'firebase/auth';

await signInWithEmailAndPassword(auth, email, password);
```

**ログアウト**:
```javascript
import { signOut } from 'firebase/auth';

await signOut(auth);
```

### 6.4 Firestore API

**セッション保存**:
```javascript
import { collection, addDoc, serverTimestamp } from 'firebase/firestore';

await addDoc(collection(db, 'sessions'), {
  ...sessionData,
  createdAt: serverTimestamp()
});
```

**セッション一覧取得**:
```javascript
import { collection, query, where, orderBy, limit, getDocs } from 'firebase/firestore';

const q = query(
  collection(db, 'sessions'),
  where('userId', '==', currentUserId),
  orderBy('timestamp', 'desc'),
  limit(10)
);
const snapshot = await getDocs(q);
```

---

## 7. セキュリティ要件

### 7.1 Firebase セキュリティルール

**Firestore Rules**:
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // users コレクション
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // sessions コレクション
    match /sessions/{sessionId} {
      allow read, write: if request.auth != null && 
                           request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && 
                      request.auth.uid == request.resource.data.userId;
    }
  }
}
```

### 7.2 API キー管理

**環境変数**:
```javascript
// .env
OPENAI_API_KEY=sk-...
FIREBASE_API_KEY=...
FIREBASE_AUTH_DOMAIN=...
FIREBASE_PROJECT_ID=...
```

**ベストプラクティス**:
- `.env`をGitignoreに追加
- 本番環境ではExpo Secretsを使用
- APIキーをクライアント側にハードコードしない

### 7.3 データ保護

- パスワードはFirebase Authが自動でハッシュ化
- 音声データは一時的な処理のみ（保存しない）
- セッションデータは所有者のみアクセス可能
- HTTPS通信の強制

---

## 8. 非機能要件

### 8.1 パフォーマンス

**目標値**:
- 画面遷移: 200ms以内
- AI質問生成: 5秒以内
- AIフィードバック生成: 10秒以内
- 音声認識レスポンス: 2秒以内
- 履歴一覧読み込み: 1秒以内

**最適化手法**:
- 画像の遅延読み込み
- リストのvirtualization
- APIレスポンスのキャッシング
- 不要な再レンダリングの削減

### 8.2 ユーザビリティ

**アクセシビリティ**:
- 文字サイズ: 最小14pt
- コントラスト比: WCAG AA基準準拠
- タッチターゲット: 最小44x44pt
- スクリーンリーダー対応（将来対応）

**レスポンシブデザイン**:
- スマートフォン（縦向き）: 375px〜
- タブレット: 768px〜
- 横向き対応

### 8.3 互換性

**対応OS**:
- iOS: 13.0以上
- Android: 6.0 (API level 23)以上

**対応ブラウザ**（Web版展開時）:
- Chrome, Safari, Edge（最新2バージョン）

### 8.4 可用性

**オフライン対応**:
- キャッシュされた画面は表示可能
- オフライン時の適切なエラー表示
- オンライン復帰時の自動同期

**エラーリカバリ**:
- ネットワークエラー時の自動リトライ（最大3回）
- セッションデータの自動保存（クラッシュ対策）
- エラーログの記録（Sentry等の導入検討）

---

## 9. 成功指標（KPI）

### 9.1 技術的指標

- ✅ 全機能が正常に動作
- ✅ クラッシュ率: 1%未満
- ✅ APIエラー率: 5%未満
- ✅ 平均セッション時間: 5-10分
- ✅ セッション完了率: 70%以上

### 9.2 ポートフォリオ評価指標

- ✅ コードの可読性・保守性
- ✅ Git commitの適切さ
- ✅ ドキュメントの充実度
- ✅ デモのスムーズさ
- ✅ 実装した機能の網羅性

---

## 10. リスク管理

### 10.1 技術的リスク

| リスク | 影響 | 対策 | 優先度 |
|--------|------|------|--------|
| OpenAI APIコスト超過 | 高 | 使用量監視、キャッシング | 高 |
| 音声認識精度低下 | 中 | フォールバック（テキスト入力） | 中 |
| Firebase無料枠超過 | 中 | 使用量監視、最適化 | 中 |
| レスポンス遅延 | 低 | ローディング表示、非同期処理 | 低 |

### 10.2 スケジュールリスク

| リスク | 対策 |
|--------|------|
| 技術的な詰まり | 30分ルール（30分で質問） |
| 機能の複雑化 | Week 1, 2終了時に見直し |
| テスト時間不足 | Day 18-19を必ずテストに充てる |

---

## 11. 開発ガイドライン

### 11.1 コーディング規約

**命名規則**:
- コンポーネント: PascalCase (例: `PracticeScreen`)
- 関数/変数: camelCase (例: `handleSubmit`)
- 定数: UPPER_SNAKE_CASE (例: `API_BASE_URL`)
- ファイル名: コンポーネントと同名

**フォルダ構造**:
```
/src
  /screens
  /components
  /contexts
  /services
    - authService.js
    - firestoreService.js
    - openaiService.js
  /constants
    - scenes.js
    - prompts.js
  /utils
  /navigation
  /assets
```

### 11.2 Git運用

**ブランチ戦略**:
- `main`: 本番相当
- `develop`: 開発ブランチ
- `feature/xxx`: 機能開発

**コミットメッセージ**:
```
[種別] 簡潔な説明

詳細説明（任意）

例:
[feat] 音声入力コンポーネント実装
[fix] ログイン画面のバリデーション修正
[docs] README更新
```

**コミット頻度**:
- 最低1日1コミット
- 機能完成時は必ずコミット
- 作業終了時は必ずプッシュ

---

## 12. テスト計画

### 12.1 機能テスト

**チェックリスト**（Day 18実施）:

**認証**:
- [ ] サインアップ（正常系）
- [ ] サインアップ（エラー系: 重複メール）
- [ ] ログイン（正常系）
- [ ] ログイン（エラー系: 誤ったパスワード）
- [ ] ログアウト
- [ ] ゲストモード

**場面選択**:
- [ ] 4つの場面が表示される
- [ ] 各場面をタップして練習開始

**練習セッション**:
- [ ] 固定質問が表示される
- [ ] 音声入力が動作する
- [ ] テキスト編集ができる
- [ ] AI質問が生成される（3-5問）
- [ ] 生成された質問に順番に回答できる
- [ ] 進捗表示が正しく更新される
- [ ] セッション途中で終了できる

**フィードバック**:
- [ ] フィードバックが生成される
- [ ] 良かった点が表示される
- [ ] 改善点が表示される
- [ ] 「もう一度練習」が動作する
- [ ] 「別の場面」が動作する
- [ ] 「保存」が動作する（認証済み）

**履歴**:
- [ ] セッション一覧が表示される
- [ ] セッション詳細が表示される
- [ ] セッション削除ができる
- [ ] Pull to Refreshが動作する

**プロフィール**:
- [ ] ユーザー情報が表示される
- [ ] ログアウトが動作する

### 12.2 エッジケーステスト

- [ ] 極端に長い回答（1000文字以上）
- [ ] 極端に短い回答（10文字未満）
- [ ] 特殊文字・絵文字入力
- [ ] ネットワーク切断時の動作
- [ ] APIエラー時の動作
- [ ] メモリ不足時の動作

---

## 13. デプロイ計画

### 13.1 Expo Publish

**手順**:
```bash
# ビルド前の確認
expo doctor

# 本番用ビルド
expo publish --release-channel production

# QRコードで動作確認
expo start --no-dev
```

### 13.2 App Store対応（将来）

- Apple Developer Program登録
- EAS Buildでビルド
- TestFlight配信
- App Store審査

---

## 14. ドキュメント要件

### 14.1 README.md

**必須セクション**:
1. プロジェクト概要
2. スクリーンショット（各主要画面）
3. 主要機能
4. 技術スタック
5. セットアップ手順
6. 環境変数設定
7. 実行方法
8. 工夫した点
9. 今後の改善案
10. ライセンス

### 14.2 コードコメント

**必須箇所**:
- 複雑なロジック
- API呼び出し
- プロンプト設計の意図
- ハードコードされた値の理由

---

## 15. 付録

### 15.1 参考リソース

**公式ドキュメント**:
- [React Native](https://reactnavigation.org/)
- [Expo](https://docs.expo.dev/)
- [Firebase](https://firebase.google.com/docs)
- [OpenAI API](https://platform.openai.com/docs)

**学習リソース**:
- React Navigation チュートリアル
- Firebase Authentication チュートリアル
- OpenAI API クイックスタート

### 15.2 用語集

- **セッション**: 1回の練習の単位
- **固定質問**: 各場面に事前定義された最初の質問
- **AI追加質問**: ユーザーの回答に基づいて動的生成される3-5問
- **フィードバック**: AIが提供する評価とアドバイス
- **ゲストモード**: 認証なしでアプリを試用できるモード

---

**文書管理**:
- 作成者: プロジェクトオーナー
- 最終更新日: 2025年10月5日
- バージョン: 3.0（フル機能版）
- 次回レビュー: Week 1終了時（Day 7）